{
  "comments": [
    {
      "id": "IC_kwDOP0125M7nf5KP",
      "author": { "login": "google-labs-jules" },
      "authorAssociation": "CONTRIBUTOR",
      "body": "üëã Jules, reporting for duty! I'm here to lend a hand with this pull request.\n\nWhen you start a review, I'll add a üëÄ emoji to each comment to let you know I've read it. I'll focus on feedback directed at me and will do my best to stay out of conversations between you and other bots or reviewers to keep the noise down.\n\nI'll push a commit with your requested changes shortly after. Please note there might be a delay between these steps, but rest assured I'm on the job!\n\nFor more direct control, you can switch me to **Reactive Mode**. When this mode is on, I will only act on comments where you specifically mention me with `@jules`. You can find this option in the **Pull Request** section of your [global Jules UI settings](https://jules.google.com/settings). You can always switch back!\n\nNew to Jules? Learn more at [jules.google/docs](https://jules.google/docs).\n\n---\n*_For security, I will only act on instructions from the user who triggered this task._*",
      "createdAt": "2026-02-11T11:40:56Z",
      "includesCreatedEdit": false,
      "isMinimized": false,
      "minimizedReason": "",
      "reactionGroups": [],
      "url": "https://github.com/Doezer/Questarr/pull/385#issuecomment-3883897487",
      "viewerDidAuthor": false
    },
    {
      "id": "IC_kwDOP0125M7nf5zX",
      "author": { "login": "gemini-code-assist" },
      "authorAssociation": "CONTRIBUTOR",
      "body": "## Summary of Changes\n\nHello @Doezer, I'm Gemini Code Assist[^1]! I'm currently reviewing this pull request and will post my feedback shortly. In the meantime, here's a summary to help you and other reviewers quickly get up to speed!\n\nThis pull request significantly enhances the application's security by patching a critical SSRF vulnerability. The core change involves a more thorough validation of IP addresses during DNS resolution, preventing attackers from bypassing internal network access controls through DNS rebinding. By checking all resolved IPs instead of just the first, the system now offers a stronger defense against malicious redirects to sensitive internal services.\n\n### Highlights\n\n* **SSRF DNS Rebinding Vulnerability Fix**: Addressed a high-severity Server-Side Request Forgery (SSRF) vulnerability where the previous implementation only checked the first resolved IP address, making it susceptible to DNS rebinding attacks.\n* **Comprehensive IP Validation**: Modified `isSafeUrl` and `safeFetch` functions to use `dns.lookup({ all: true })` and validate *all* resolved IP addresses for a given hostname. If any resolved IP is deemed unsafe, the request is blocked.\n* **Enhanced Test Coverage**: Introduced new test cases in `server/__tests__/ssrf.test.ts` to specifically cover scenarios involving hostnames that resolve to a mix of safe and unsafe IP addresses, as well as metadata service IPs, ensuring the fix is robust.\n\n<details>\n<summary><b>Changelog</b></summary>\n\n* **client/__tests__/GameDetailsModal.test.tsx**\n    * Reformatted test file for consistent indentation.\n* **client/__tests__/usenet-utils.test.ts**\n    * Reformatted test file for consistent indentation.\n* **client/src/components/RssFeedList.tsx**\n    * Reformatted JSX structure for improved readability.\n* **client/src/components/ui/badge.tsx**\n    * Reformatted interface definition for `BadgeProps`.\n* **client/src/pages/rss.tsx**\n    * Reformatted JSX structure for consistent indentation.\n* **client/src/pages/xrel-releases.tsx**\n    * Reformatted JSX structure and conditional rendering for consistent indentation.\n* **playwright.config.ts**\n    * Reformatted configuration object for consistent indentation and spacing.\n* **scripts/debug-igdb.ts**\n    * Removed an empty line and reformatted code for consistent indentation.\n* **server/__tests__/igdb.test.ts**\n    * Reformatted arrow function syntax and array literal for consistent indentation.\n* **server/__tests__/ssrf.test.ts**\n    * Updated `dns.lookup` mocks to return an array of addresses, aligning with the `all: true` option.\n    * Added a new test case to verify that hostnames resolving to both safe and unsafe IPs are blocked.\n    * Added a new test case to ensure hostnames resolving to metadata service IPs are blocked.\n    * Added a new test case to `safeFetch` to reject requests if any resolved IP is unsafe, preventing DNS rebinding.\n* **server/rss.ts**\n    * Reformatted the catch block for `processPendingItems` for consistent arrow function syntax.\n* **server/ssrf.ts**\n    * Modified `isSafeUrl` to use `dns.lookup(hostname, { all: true })` to retrieve all resolved IP addresses.\n    * Implemented a loop in `isSafeUrl` to iterate through all resolved IP addresses and return `false` if any address is deemed unsafe.\n    * Modified `safeFetch` to also use `dns.lookup(hostname, { all: true })` and validate all resolved IP addresses, throwing an error if any are unsafe.\n    * Added an explicit `isSafeIp` check in `safeFetch` when the hostname is already an IP address.\n* **tests/e2e/auth.spec.ts**\n    * Reformatted test code for consistent indentation and string literals.\n* **tests/e2e/game-details.spec.ts**\n    * Reformatted test code for consistent indentation and string literals.\n* **tests/e2e/navigation.spec.ts**\n    * Reformatted test code for consistent indentation and removed an empty line.\n</details>\n\n<details>\n<summary><b>Activity</b></summary>\n\n* This pull request was automatically created by Jules for task 6441558472011113379, initiated by @Doezer.\n</details>\n\n<details>\n<summary><b>Using Gemini Code Assist</b></summary>\n<br>\n\nThe full guide for Gemini Code Assist can be found on our [documentation page](https://developers.google.com/gemini-code-assist/docs/review-github-code), here are some quick tips.\n\n<b>Invoking Gemini</b>\n\nYou can request assistance from Gemini at any point by creating a comment using either `/gemini <command>` or `@gemini-code-assist <command>`. Below is a summary of the supported commands on the current page.\n\nFeature | Command | Description\n--- | --- | ---\nCode Review | `/gemini review` | Performs a code review for the current pull request in its current state.\nPull Request Summary | `/gemini summary` | Provides a summary of the current pull request in its current state.\nComment | @gemini-code-assist | Responds in comments when explicitly tagged, both in pull request comments and review comments.\nHelp | `/gemini help` | Displays a list of available commands.\n\n<b>Customization</b>\n\nTo customize Gemini Code Assist for GitHub experience, repository maintainers can create a configuration file and/or provide a custom code review style guide (such as PEP-8 for Python) by creating and adding files to a `.gemini/` folder in the base of the repository. Detailed instructions can be found [here](https://developers.google.com/gemini-code-assist/docs/customize-gemini-behavior-github).\n\n<b>Limitations & Feedback</b>\n\nGemini Code Assist may make mistakes. Please leave feedback on any instances where its feedback is incorrect or counter productive. You can react with :thumbsup: and :thumbsdown: on @gemini-code-assist comments. If you're interested in giving your feedback about your experience with Gemini Code Assist for Github and other Google products, sign up [here](https://google.qualtrics.com/jfe/form/SV_2cyuGuTWsEw84yG).\n\n<b>You can also get AI-powered code generation, chat, as well as code reviews directly in the IDE at no cost with the [Gemini Code Assist IDE Extension](https://cloud.google.com/products/gemini/code-assist).</b>\n</details>\n\n\n[^1]: Review the [Privacy Notices](https://policies.google.com/privacy), [Generative AI Prohibited Use Policy](https://policies.google.com/terms/generative-ai/use-policy), [Terms of Service](https://policies.google.com/terms), and learn how to configure Gemini Code Assist in GitHub [here](https://developers.google.com/gemini-code-assist/docs/customize-gemini-behavior-github). Gemini can make mistakes, so double check it and [use code with caution](https://support.google.com/legal/answer/13505487).\n",
      "createdAt": "2026-02-11T11:41:20Z",
      "includesCreatedEdit": false,
      "isMinimized": false,
      "minimizedReason": "",
      "reactionGroups": [],
      "url": "https://github.com/Doezer/Questarr/pull/385#issuecomment-3883900119",
      "viewerDidAuthor": false
    },
    {
      "id": "IC_kwDOP0125M7nf7-N",
      "author": { "login": "codecov" },
      "authorAssociation": "NONE",
      "body": "## [Codecov](https://app.codecov.io/gh/Doezer/Questarr/pull/385?dropdown=coverage&src=pr&el=h1&utm_medium=referral&utm_source=github&utm_content=comment&utm_campaign=pr+comments&utm_term=Doezer) Report\n:x: Patch coverage is `94.44444%` with `1 line` in your changes missing coverage. Please review.\n:white_check_mark: All tests successful. No failed tests found.\n| [Files with missing lines](https://app.codecov.io/gh/Doezer/Questarr/pull/385?dropdown=coverage&src=pr&el=tree&utm_medium=referral&utm_source=github&utm_content=comment&utm_campaign=pr+comments&utm_term=Doezer) | Patch % | Lines |\n|---|---|---|\n| [server/ssrf.ts](https://app.codecov.io/gh/Doezer/Questarr/pull/385?src=pr&el=tree&utm_medium=referral&utm_source=github&utm_content=comment&utm_campaign=pr+comments&utm_term=Doezer#diff-c2VydmVyL3NzcmYudHM=) | 94.11% | [1 Missing :warning: ](https://app.codecov.io/gh/Doezer/Questarr/pull/385?src=pr&el=tree&utm_medium=referral&utm_source=github&utm_content=comment&utm_campaign=pr+comments&utm_term=Doezer) |\n\n:loudspeaker: Thoughts on this report? [Let us know!](https://github.com/codecov/feedback/issues/255)",
      "createdAt": "2026-02-11T11:42:47Z",
      "includesCreatedEdit": false,
      "isMinimized": false,
      "minimizedReason": "",
      "reactionGroups": [],
      "url": "https://github.com/Doezer/Questarr/pull/385#issuecomment-3883909005",
      "viewerDidAuthor": false
    },
    {
      "id": "IC_kwDOP0125M7qxtKS",
      "author": { "login": "Doezer" },
      "authorAssociation": "OWNER",
      "body": "The TOCTOU vulnerability related to empty DNS arrays has been addressed in both \\`isSafeUrl\\` and \\`safeFetch\\`, and tests have been added for this edge case. Additionally, the XSS vulnerability in \\`RssFeedList.tsx\\` has been fixed using a new \\`safeUrl\\` utility. I've successfully resolved the conflicts by rebasing the branch onto \\`release/1.3.0\\` while prioritizing the new logic, and all checks (linting & unit testing) pass successfully.",
      "createdAt": "2026-02-21T14:46:28Z",
      "includesCreatedEdit": false,
      "isMinimized": false,
      "minimizedReason": "",
      "reactionGroups": [{ "content": "EYES", "users": { "totalCount": 1 } }],
      "url": "https://github.com/Doezer/Questarr/pull/385#issuecomment-3938898578",
      "viewerDidAuthor": true
    },
    {
      "id": "IC_kwDOP0125M7qxu5h",
      "author": { "login": "google-labs-jules" },
      "authorAssociation": "CONTRIBUTOR",
      "body": "> The TOCTOU vulnerability related to empty DNS arrays has been addressed in both \\`isSafeUrl\\` and \\`safeFetch\\`, and tests have been added for this edge case. Additionally, the XSS vulnerability in \\`RssFeedList.tsx\\` has been fixed using a new \\`safeUrl\\` utility. I've successfully resolved the conflicts by rebasing the branch onto \\`release/1.3.0\\` while prioritizing the new logic, and all checks (linting & unit testing) pass successfully.\n\nI have addressed the feedback:\n\n1.  **Empty DNS Arrays**: Updated `server/ssrf.ts` to explicitly handle the case where `dns.lookup` returns an empty array, treating it as a failure. Added a test case in `server/__tests__/ssrf.test.ts` to verify this behavior.\n2.  **Client-Side XSS**: Implemented a `safeUrl` utility in `client/src/lib/utils.ts` and updated `client/src/components/RssFeedList.tsx` to sanitize `item.link` before rendering. Added `client/__tests__/utils.test.ts` to verify `safeUrl` correctly blocks `javascript:` URLs and allows valid ones.\n\nAll tests are passing.",
      "createdAt": "2026-02-21T14:51:15Z",
      "includesCreatedEdit": false,
      "isMinimized": false,
      "minimizedReason": "",
      "reactionGroups": [],
      "url": "https://github.com/Doezer/Questarr/pull/385#issuecomment-3938905697",
      "viewerDidAuthor": false
    }
  ],
  "number": 385,
  "reviews": [
    {
      "id": "PRR_kwDOP0125M7hj_iG",
      "author": { "login": "gemini-code-assist" },
      "authorAssociation": "CONTRIBUTOR",
      "body": "## Code Review\n\nThis pull request aims to address a critical SSRF vulnerability related to DNS rebinding by switching to `dns.lookup({ all: true })` and validating all resolved IP addresses. However, the protection remains vulnerable to a TOCTOU (Time-of-Check Time-of-Use) attack for HTTPS requests because the validated IP address is not pinned for the actual network call. Additionally, two critical edge cases have been identified where an empty DNS resolution result could allow the vulnerability to persist, requiring further attention to ensure the fix is robust.",
      "submittedAt": "2026-02-11T11:44:39Z",
      "includesCreatedEdit": false,
      "reactionGroups": [],
      "state": "COMMENTED",
      "commit": { "oid": "04eff10936062610cf11657c125ad28fa489b748" }
    },
    {
      "id": "PRR_kwDOP0125M7hkHit",
      "author": { "login": "gemini-code-assist" },
      "authorAssociation": "CONTRIBUTOR",
      "body": "## Code Review\n\nThis pull request primarily focuses on enhancing security by preventing DNS rebinding attacks in the `isSafeUrl` and `safeFetch` functions within `server/ssrf.ts`. The changes involve modifying `dns.lookup` to retrieve all resolved IP addresses for a given hostname and then iterating through them to ensure none are unsafe. Corresponding unit tests in `server/__tests__/ssrf.test.ts` were updated and expanded to cover these new security checks, including scenarios for DNS rebinding and metadata service IP blocking. Minor formatting adjustments were also made across several client-side and test files. The review comments highlight a critical client-side XSS vulnerability in `client/src/components/RssFeedList.tsx` due to unvalidated `item.link` usage, recommending a `safeUrl` utility. Additionally, the reviewer suggests further hardening the DNS resolution logic in `server/ssrf.ts` by adding explicit checks for empty address arrays returned by `dns.lookup` in both `isSafeUrl` and `safeFetch`, along with new unit tests for this edge case.",
      "submittedAt": "2026-02-11T11:53:05Z",
      "includesCreatedEdit": false,
      "reactionGroups": [],
      "state": "COMMENTED",
      "commit": { "oid": "04eff10936062610cf11657c125ad28fa489b748" }
    }
  ],
  "title": "üõ°Ô∏è Sentinel: [HIGH] Fix SSRF DNS Rebinding vulnerability",
  "url": "https://github.com/Doezer/Questarr/pull/385"
}
